<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Kahack</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  min-height: 100vh;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
  font-family: 'Inter', -apple-system, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.card {
  background: linear-gradient(145deg, #252547, #1e1e3f);
  border: 1px solid rgba(139, 92, 246, 0.2);
  border-radius: 24px;
  padding: 40px;
  width: 100%;
  max-width: 400px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 60px rgba(139, 92, 246, 0.15);
}

@media (min-width: 768px) {
  .card {
    max-width: 650px;
    padding: 48px 60px;
  }
  
  .row {
    grid-template-columns: 1fr 1fr 1fr;
  }
  
  .stats {
    grid-template-columns: 1fr 1fr;
  }
  
  .btn-row {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 12px;
  }
  
  .btn-row .btn {
    margin-top: 0;
  }
}

.logo {
  text-align: center;
  margin-bottom: 32px;
}

.logo h1 {
  font-size: 36px;
  font-weight: 700;
  background: linear-gradient(135deg, #a78bfa, #c084fc, #e879f9);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.logo p {
  font-size: 13px;
  color: #7c7c9a;
  margin-top: 4px;
}

.field {
  margin-bottom: 20px;
}

.field label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: #a5a5c7;
  margin-bottom: 8px;
}

.field input {
  width: 100%;
  padding: 14px 16px;
  background: rgba(139, 92, 246, 0.08);
  border: 2px solid rgba(139, 92, 246, 0.2);
  border-radius: 12px;
  color: #fff;
  font-size: 15px;
  font-family: inherit;
  transition: all 0.2s;
}

.field input:focus {
  outline: none;
  border-color: #a78bfa;
  background: rgba(139, 92, 246, 0.15);
  box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.15);
}

.field input::placeholder { color: #6b6b8a; }

.checkbox-field {
  margin-top: 8px;
  margin-bottom: 20px;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  font-size: 14px;
  color: #a5a5c7;
  font-weight: 500;
}

.checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: #a78bfa;
  cursor: pointer;
}

.checkbox-field .hint {
  display: block;
  font-size: 11px;
  color: #6b6b8a;
  margin-top: 6px;
  margin-left: 28px;
}

.answer-section {
  margin-top: 20px;
  padding: 20px;
  background: rgba(139, 92, 246, 0.08);
  border: 1px solid rgba(139, 92, 246, 0.15);
  border-radius: 16px;
}

.answer-section h4 {
  color: #a5a5c7;
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 12px;
}

.answer-mode {
  margin-bottom: 16px;
}

.answer-mode select {
  width: 100%;
  padding: 10px 14px;
  background: rgba(139, 92, 246, 0.1);
  border: 2px solid rgba(139, 92, 246, 0.2);
  border-radius: 10px;
  color: #fff;
  font-size: 14px;
  font-family: inherit;
  cursor: pointer;
}

.answer-mode select:focus {
  outline: none;
  border-color: #a78bfa;
}

.answer-mode select option {
  background: #1e1e3f;
  color: #fff;
}

.answer-buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}

.answer-btn {
  aspect-ratio: 1;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  opacity: 0.85;
}

.answer-btn:hover {
  opacity: 1;
  transform: scale(1.05);
}

.answer-btn:active {
  transform: scale(0.95);
}

.answer-btn svg {
  width: 32px;
  height: 32px;
  fill: white;
}

.answer-btn.red { background: #e21b3c; }
.answer-btn.blue { background: #1368ce; }
.answer-btn.yellow { background: #d89e00; }
.answer-btn.green { background: #26890c; }

@keyframes pulse {
  0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.4); }
  50% { transform: scale(1.1); box-shadow: 0 0 20px 5px rgba(255,255,255,0.3); }
}

.game-log {
  margin-top: 20px;
  background: linear-gradient(145deg, rgba(139, 92, 246, 0.15), rgba(168, 85, 247, 0.08));
  border: 1px solid rgba(139, 92, 246, 0.3);
  border-radius: 12px;
  padding: 12px;
  max-height: 180px;
  overflow-y: auto;
}

.game-log h4 {
  color: #c4b5fd;
  font-size: 12px;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.game-log p {
  font-size: 11px;
  color: #d1d5db;
  padding: 4px 0;
  border-bottom: 1px solid rgba(139, 92, 246, 0.15);
}

.game-log p.warning { color: #fbbf24; }
.game-log p.error { color: #f87171; }
.game-log p.success { color: #a78bfa; }

.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.btn-row {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
}

.btn {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-start {
  background: linear-gradient(135deg, #8b5cf6, #a855f7, #c026d3);
  color: #fff;
  box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
}

.btn-start:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 30px rgba(139, 92, 246, 0.5);
}

.btn-kill {
  background: rgba(239, 68, 68, 0.15);
  color: #f87171;
  border: 2px solid rgba(239, 68, 68, 0.3);
}

.btn-kill:hover:not(:disabled) {
  background: rgba(239, 68, 68, 0.25);
  border-color: rgba(239, 68, 68, 0.5);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

.stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-top: 28px;
}

.stat {
  background: rgba(139, 92, 246, 0.1);
  border: 1px solid rgba(139, 92, 246, 0.15);
  border-radius: 16px;
  padding: 20px;
  text-align: center;
}

.stat.good { 
  background: rgba(34, 197, 94, 0.1);
  border-color: rgba(34, 197, 94, 0.2);
}
.stat.bad { 
  background: rgba(239, 68, 68, 0.1);
  border-color: rgba(239, 68, 68, 0.2);
}

.stat-num {
  font-size: 32px;
  font-weight: 700;
}

.stat.good .stat-num { color: #4ade80; }
.stat.bad .stat-num { color: #f87171; }

.stat-label {
  font-size: 12px;
  color: #8b8bab;
  font-weight: 500;
  margin-top: 4px;
}

#toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: linear-gradient(135deg, #8b5cf6, #a855f7);
  color: #fff;
  padding: 14px 28px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 500;
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 999;
  box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
}

#toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.footer {
  text-align: center;
  margin-top: 24px;
  font-size: 12px;
  color: #5c5c7a;
}
</style>
</head>
<body>

<div class="card">
  <div class="logo">
    <h1>Kahack</h1>
    <p>Bot Flooder</p>
  </div>

  <div class="field">
    <label>Game PIN</label>
    <input type="text" id="gamePin" placeholder="Enter game PIN" maxlength="10" autocomplete="off">
  </div>

  <div class="row">
    <div class="field">
      <label>Bot Name</label>
      <input type="text" id="botName" value="Bot" placeholder="Bot">
    </div>
    <div class="field">
      <label>Count</label>
      <input type="number" id="botCount" value="10" min="1" max="2000">
    </div>
  </div>

  <div class="field checkbox-field">
    <label class="checkbox-label">
      <input type="checkbox" id="bypassFilter">
      <span class="checkmark"></span>
      <span>Bypass Name Filter</span>
    </label>
    <span class="hint">Uses lookalike Unicode characters to bypass filters</span>
  </div>

  <div class="btn-row">
    <button class="btn btn-start" id="startBtn" onclick="startFlood()">Start Flood</button>
    <button class="btn btn-stop" id="stopBtn" onclick="stopJoining()" style="display:none">Stop Joining</button>
    <button class="btn btn-kill" id="killBtn" onclick="killAll()">Kill All</button>
  </div>

  <div class="stats">
    <div class="stat good">
      <div class="stat-num" id="joinedCount">0</div>
      <div class="stat-label">Joined</div>
    </div>
    <div class="stat bad">
      <div class="stat-num" id="failedCount">0</div>
      <div class="stat-label">Failed</div>
    </div>
  </div>

  <div class="answer-section">
    <h4>Answer Control</h4>
    <div class="answer-mode">
      <select id="answerMode">
        <option value="manual">Manual (click buttons)</option>
        <option value="random" selected>Random (auto)</option>
        <option value="first">Always First (Red)</option>
        <option value="second">Always Second (Blue)</option>
        <option value="third">Always Third (Yellow)</option>
        <option value="fourth">Always Fourth (Green)</option>
      </select>
    </div>
    <div class="answer-buttons" id="answerButtons">
      <button class="answer-btn red" onclick="sendAnswer(0)" title="Red / Triangle">
        <svg viewBox="0 0 32 32"><path d="M27,24.559972 L5,24.559972 L16,7 L27,24.559972 Z"/></svg>
      </button>
      <button class="answer-btn blue" onclick="sendAnswer(1)" title="Blue / Diamond">
        <svg viewBox="0 0 32 32"><path d="M4,16 L16,4 L28,16 L16,28 Z"/></svg>
      </button>
      <button class="answer-btn yellow" onclick="sendAnswer(2)" title="Yellow / Circle">
        <svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="11"/></svg>
      </button>
      <button class="answer-btn green" onclick="sendAnswer(3)" title="Green / Square">
        <svg viewBox="0 0 32 32"><rect x="7" y="7" width="18" height="18"/></svg>
      </button>
    </div>
  </div>

  <div class="game-log">
    <h4>ðŸ“‹ Game Log</h4>
    <div id="gameLogs"></div>
  </div>

  <div class="footer">Â© 2025 Kahack</div>
</div>

<div id="toast"></div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const GITHUB_BACKEND_URL = 'https://raw.githubusercontent.com/kahackflooder/backend-url/main/backend.json';
let BACKEND = null;
let socket = null;
let currentQuestionIndex = -1;
let answered = true;

async function loadBackendUrl() {
  try {
    const res = await fetch(GITHUB_BACKEND_URL, { cache: 'no-store' });
    const data = await res.json();
    if (data.url) {
      BACKEND = data.url;
      console.log('Backend URL loaded:', BACKEND);
      return true;
    }
  } catch (e) {
    console.error('Failed to load backend URL:', e);
  }
  return false;
}

async function initApp() {
  const loaded = await loadBackendUrl();
  if (!loaded) {
    showToast('Failed to load backend URL from GitHub', 'error');
    return;
  }
  
  socket = io(BACKEND);
  setupSocketListeners();
  showToast('Connected to backend', 'success');
  setInterval(pollStats, 1000);
}

function setupSocketListeners() {
  socket.on('botJoinSuccess', (data) => {
    const el = document.getElementById('joinedCount');
    el.textContent = parseInt(el.textContent) + 1;
    addLog(`âœ… ${data.name} joined`);
  });

  socket.on('botJoinBatch', (data) => {
    const el = document.getElementById('joinedCount');
    el.textContent = parseInt(el.textContent) + data.count;
    if (data.count > 5) {
      addLog(`âœ… ${data.count} bots joined`);
    } else {
      addLog(`âœ… ${data.names.join(', ')} joined`);
    }
  });

  socket.on('botJoinFail', (data) => {
    addLog(`âš ï¸ ${data.message}`, 'warning');
  });

  socket.on('botDisconnected', (data) => {
    addLog(`âŒ ${data.name} disconnected`, 'error');
  });

  socket.on('questionStart', (data) => {
    currentQuestionIndex = data.questionIndex;
    answered = false;
    addLog(`ðŸŽ¯ Question ${data.questionIndex + 1} started (${data.choices} choices)`);
    const btns = document.querySelectorAll('.answer-btn');
    btns.forEach(b => {
      b.style.animation = 'pulse 0.5s ease-in-out 2';
      setTimeout(() => b.style.animation = '', 1000);
    });
  });

  socket.on('questionAnswered', (data) => {
    answered = true;
    const colors = ['Red', 'Blue', 'Yellow', 'Green'];
    addLog(`ðŸ“ Bots answered ${colors[data.answer] || data.answer}!`);
  });

  socket.on('quizStarted', () => {
    addLog(`ðŸ† Quiz has started!`);
  });

  socket.on('spawnStopped', (data) => {
    addLog(`â¹ï¸ Spawn stopped: ${data.spawned}/${data.total} bots created`, 'warning');
    document.getElementById('stopBtn').style.display = 'none';
    document.getElementById('startBtn').disabled = false;
    document.getElementById('startBtn').textContent = 'Start Flood';
  });
}

async function apiFetch(path, options = {}) {
  if (!BACKEND) throw new Error('Backend not loaded');
  try {
    const r = await fetch(BACKEND + path, { ...options, signal: AbortSignal.timeout(5000) });
    return r;
  } catch(e) {
    throw new Error('Backend connection failed');
  }
}

function addLog(msg, type = 'info') {
  const logsEl = document.getElementById('gameLogs');
  if (!logsEl) return;
  const p = document.createElement('p');
  p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  p.className = type;
  logsEl.prepend(p);
  while (logsEl.children.length > 50) logsEl.removeChild(logsEl.lastChild);
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

function updateStats(s) {
  document.getElementById('joinedCount').textContent = s.joined || 0;
  document.getElementById('failedCount').textContent = s.failed || 0;
}

async function pollStats() {
  if (!BACKEND) return;
  try {
    const r = await apiFetch('/api/bots');
    if (r.ok) updateStats(await r.json());
  } catch(e) {}
}

async function startFlood() {
  const pin = document.getElementById('gamePin').value.trim();
  const baseName = document.getElementById('botName').value.trim() || 'Bot';
  const count = parseInt(document.getElementById('botCount').value) || 10;
  const bypass = document.getElementById('bypassFilter').checked;

  if (!pin || !/^\d+$/.test(pin)) {
    showToast('Enter a valid PIN');
    return;
  }

  const btn = document.getElementById('startBtn');
  btn.disabled = true;
  btn.textContent = 'Starting...';
  document.getElementById('stopBtn').style.display = 'block';
  
  try {
    const r = await apiFetch('/api/spawn', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ pin, count, baseName, bypass })
    });
    const d = await r.json();
    showToast(r.ok ? `Spawning ${count} bots` : (d.error || 'Failed'));
  } catch(e) {
    showToast('Connection error');
  }
  
  btn.disabled = false;
  btn.textContent = 'Start Flood';
  document.getElementById('stopBtn').style.display = 'none';
}

async function stopJoining() {
  try {
    await apiFetch('/api/stop-spawn', { method: 'POST' });
    showToast('Stopping bot spawn...');
    document.getElementById('stopBtn').style.display = 'none';
    document.getElementById('startBtn').disabled = false;
    document.getElementById('startBtn').textContent = 'Start Flood';
  } catch(e) {
    showToast('Stop failed');
  }
}

async function killAll() {
  const btn = document.getElementById('killBtn');
  btn.disabled = true;
  btn.textContent = 'Killing...';
  
  try {
    const r = await apiFetch('/api/kill-all', { method: 'POST' });
    const d = await r.json();
    showToast(r.ok ? `Killed ${d.killed} bots` : 'Kill failed');
    document.getElementById('joinedCount').textContent = '0';
    document.getElementById('failedCount').textContent = '0';
  } catch(e) {
    showToast('Connection error');
  }
  
  btn.disabled = false;
  btn.textContent = 'Kill All';
  setTimeout(pollStats, 500);
}

async function sendAnswer(answer) {
  try {
    const r = await apiFetch('/api/answer', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ answer })
    });
    const d = await r.json();
    if (r.ok) {
      const colors = ['Red', 'Blue', 'Yellow', 'Green', '5th', '6th', '7th', '8th'];
      showToast(`Answered ${colors[d.answer] || d.answer} (${d.sent} bots)`);
    }
  } catch(e) {
    showToast('Answer failed');
  }
}

document.getElementById('answerMode').addEventListener('change', async (e) => {
  const mode = e.target.value;
  try {
    const r = await apiFetch('/api/answer-mode', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ mode })
    });
    const d = await r.json();
    if (r.ok) {
      showToast(`Mode: ${mode} (${d.sent || 0} bots)`);
    }
  } catch(e) {
    showToast('Mode change failed');
  }
});

initApp();
</script>

</body>
</html>
